<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Unibooks</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
</head>
<body>

  <!-- Header with title and centered search -->
  <div class="header-container">
    <div class="title-group">
      <h1>
        <a href="{{ url_for('main.index') }}" style="color: inherit; text-decoration: none;">UniBooks</a>
      </h1>
      <h2>- En markedsplads for køb og<br> salg af brugte universitets bøger</h2>
    </div>

    <div class="search-wrapper" style="position: relative;">
      <input id="search-input" type="text" placeholder="Søg efter bøger, ISBN, eller forfattere...">
      <div id="search-results" class="dropdown-results"></div>
    </div>

    <!-- Top-right image -->
    <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" class="top-right-image">
  </div>

  <!-- Navbar -->
  <nav>
    <ul>
      <li><a href="/books" class="{% if active_page == 'books' %}active{% endif %}">Bøger</a></li>
      <li><a href="/authors" class="{% if active_page == 'authors' %}active{% endif %}">Forfattere</a></li>
      <li><a href="/publishers" class="{% if active_page == 'publishers' %}active{% endif %}">Forlag</a></li>
      <li><a href="/curriculum" class="{% if active_page == 'curriculum' %}active{% endif %}">Pensumliste</a></li>
    </ul>
  </nav>

  <script>
  const input = document.getElementById('search-input');
  const resultsDiv = document.getElementById('search-results');

  input.addEventListener('input', function() {
      const query = input.value;
      if (!query) {
          resultsDiv.innerHTML = '';
          return;
      }
      fetch(`/search_books?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
          resultsDiv.innerHTML = '';
          if (data && data.docs && data.docs.length > 0) {
            data.docs.slice(0, 10).forEach(book => {
              const title = book.title || 'Ukendt titel';
              const author = (book.author_name && book.author_name.join(', ')) || 'Ukendt forfatter';
              let isbn = '';
              if (Array.isArray(book.ia)) {
                const regex = /isbn_[0-9]*/;
                isbn = book.ia.find(iaItem => regex.test(iaItem));
              } else {
                isbn = book.ia || '';
              }
              const item = document.createElement('div');
              item.className = 'search-result-item';
              item.innerHTML = `<strong>${title}</strong> af ${author} <br> ISBN: ${isbn}`;
              item.addEventListener('click', () => {
                alert(`Du har valgt: ${title} af ${author} (ISBN: ${isbn})`);
                resultsDiv.innerHTML = '';
                input.value = title;
              });
              resultsDiv.appendChild(item);
            });
          }
        });
  });

  // Optional: Hide dropdown when clicking outside
  document.addEventListener('click', function(event) {
    if (!event.target.closest('.search-wrapper')) {
      resultsDiv.innerHTML = '';
    }
  });
  </script>
</body>
</html>
